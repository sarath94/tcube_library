from whoosh.index import create_in,open_dir
from whoosh.fields import *
import os
import codecs

from whoosh.qparser import QueryParser
def search(query):
	ix = open_dir("work/static/indexdir")
	with ix.searcher() as searcher:
		query = QueryParser("content", ix.schema).parse(query)
		results = searcher.search_page(query,1,pagelen=10)
		result_list = []
#		results.fragmenter.maxchars = 60
#		results.fragmenter.surround = 30
		for result in results:
#			print result['title']
			filecontents = ""			
			with codecs.open(os.path.join("work/static/txt/",result['title']), "r","utf-8") as f:
	   			    filecontents = f.read()
	    		result_list.append([result['title'],result.highlights("content", text=filecontents, top=3)])
	return result_list
#search(query="sarath")
